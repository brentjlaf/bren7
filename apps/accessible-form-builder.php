<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Accessible Drag & Drop Form Builder</title>
  <!-- SEO Meta Tags -->
  <meta name="description" content="Explore web tools, generators, and utilities from BREN7 to enhance your digital projects.">
  <meta name="keywords" content="BREN7, web tools, generators, accessibility, SEO, performance, utilities">
  <meta name="author" content="Brent">
  <meta name="robots" content="index, follow">

  <!-- Open Graph -->
  <meta property="og:title" content="BREN7 – Web Projects, Tools & Experiments">
  <meta property="og:description" content="Browse a collection of creative web tools, games, and utilities built by BREN7.">
  <meta property="og:url" content="https://bren7.com/">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://bren7.com/images/favicon.jpg">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="BREN7 – Web Projects, Tools & Experiments">
  <meta name="twitter:description" content="Interactive tools and experiments by BREN7. Explore beat makers, checkers, and more.">
  <meta name="twitter:image" content="https://bren7.com/images/favicon.jpg">

  <!-- Favicon -->
  <link rel="icon" href="https://bren7.com/images/favicon.jpg" type="image/jpeg">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1RGGXKCNB6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-1RGGXKCNB6');
  </script>


  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- jQuery, jQuery UI, and Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/smoothness/jquery-ui.css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    :root {
      --bs-primary: #00a99d;
      --bs-text-color: #6c757d;
    }
    body {
      margin: 10px;
      background-color: #f8f9fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: var(--bs-text-color);
    }
    h1 {
      margin-bottom: 1rem;
      font-weight: 700;
      color: var(--bs-primary);
      font-size: 2rem;
    }
    /* Toolbox and Builder Sections */
    .toolbox-section,
    .builder-section {
      min-height: 400px;
      border: 1px dashed #ced4da;
      border-radius: 5px;
      background-color: #ffffff;
      padding: 15px;
      transition: background-color 0.3s, border-color 0.3s;
    }
    .toolbox-section:hover,
    .builder-section:hover {
      background-color: #e9ecef;
      border-color: #adb5bd;
    }
    /* Draggable Items */
    .draggable-item {
      margin-bottom: 8px;
      padding: 8px 12px;
      background-color: #ffffff;
      border: 1px solid #ced4da;
      border-radius: 4px;
      cursor: grab;
      transition: background-color 0.2s, transform 0.2s;
      font-size: 0.9rem;
      color: var(--bs-text-color);
    }
    .draggable-item:active {
      cursor: grabbing;
      transform: scale(0.98);
    }
    .draggable-item:hover {
      background-color: #f1f3f5;
    }
    /* Field Wrapper and Toolbar */
    .form-element-wrapper {
      border: 1px solid #ced4da;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 15px;
      background-color: #fdfdfd;
      position: relative;
      transition: box-shadow 0.3s, border-color 0.3s;
    }
    .form-element-wrapper:hover {
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      border-color: var(--bs-primary);
    }
    .field-toolbar {
      position: absolute;
      top: 8px;
      right: 8px;
      display: flex;
      gap: 4px;
    }
    .drag-handle {
      cursor: grab;
      font-size: 1rem;
      color: #6c757d;
      transition: color 0.3s;
    }
    .drag-handle:hover {
      color: var(--bs-primary);
    }
    .btn-edit,
    .btn-delete {
      padding: 3px 6px;
      font-size: 0.8rem;
    }
    /* Generated Code Display */
    #generated-code {
      white-space: pre-wrap;
      background: #f8f9fa;
      padding: 10px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      margin-top: 15px;
      overflow-x: auto;
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.9rem;
      color: #212529;
    }
    /* Morweb Green Buttons */
    .btn-morweb-green {
      background-color: var(--bs-primary);
      border-color: var(--bs-primary);
      color: #ffffff;
      font-weight: 600;
      padding: 8px 16px;
      font-size: 0.95rem;
      border-radius: 4px;
      transition: background-color 0.3s, border-color 0.3s;
    }
    .btn-morweb-green:hover {
      background-color: #008e7f;
      border-color: #008e7f;
      color: #ffffff;
    }
    .btn-outline-morweb-green {
      color: var(--bs-primary);
      border-color: var(--bs-primary);
      font-weight: 600;
      padding: 6px 12px;
      font-size: 0.85rem;
      border-radius: 4px;
      transition: background-color 0.3s, color 0.3s;
    }
    .btn-outline-morweb-green:hover {
      background-color: var(--bs-primary);
      color: #ffffff;
    }
    /* Help & Settings Buttons */
    .btn-help,
    .btn-settings {
      font-size: 0.85rem;
      padding: 4px 10px;
      border-radius: 4px;
      transition: background-color 0.3s, color 0.3s;
      color: var(--bs-text-color);
      background-color: transparent;
      border: 1px solid #ced4da;
    }
    .btn-help:hover,
    .btn-settings:hover {
      background-color: var(--bs-primary);
      color: #ffffff;
      border-color: var(--bs-primary);
    }
    /* Modal Styling */
    .modal-header {
      padding: 10px 15px;
      border-bottom: 1px solid #dee2e6;
    }
    .modal-title {
      font-size: 1.2rem;
      color: var(--bs-primary);
    }
    .modal-body {
      padding: 15px;
      color: var(--bs-text-color);
    }
    .modal-footer .btn {
      font-size: 0.85rem;
      padding: 5px 10px;
    }
    .form-label {
      font-size: 0.95rem;
      color: var(--bs-text-color);
    }
    .form-control,
    .form-select,
    .form-check-input {
      font-size: 0.9rem;
    }
    .btn-primary,
    .btn-secondary,
    .btn-outline-secondary {
      font-size: 0.85rem;
      padding: 6px 12px;
    }
    /* Additional styling for Form Preview Card */
    .form-preview-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 15px;
      margin: 20px auto;
      background-color: #ffffff;
    }
    /* Device Toggle Buttons in Preview */
    .preview-device-btn {
      font-size: 0.8rem;
      margin-right: 5px;
    }
  </style>
</head>

<body>
  <div class="container position-relative">
    <h1>Accessible Drag & Drop Form Builder</h1>

    <!-- Top Controls -->
    <div class="d-flex align-items-center mb-3 flex-wrap justify-content-between" style="gap: 15px;">
      <!-- Left: Prebuilt Form Selector and Load Button -->
      <div class="d-flex align-items-center flex-wrap" style="gap: 8px;">
        <div class="d-flex align-items-center">
          <label for="prebuilt-form-select" class="form-label me-2 mb-0">Prebuilt Form:</label>
          <select id="prebuilt-form-select" class="form-select w-auto me-2">
            <option value="scratch" selected>Start from scratch</option>
            <option value="contact">Contact Form</option>
            <option value="registration">Registration Form</option>
            <option value="feedback">Feedback Form</option>
            <option value="volunteer">Volunteer Form</option>
            <option value="appointment">Request an Appointment</option>
          </select>
          <button id="load-prebuilt" class="btn btn-outline-morweb-green">Load</button>
        </div>
      </div>
      <!-- Right: Help & Settings Buttons -->
      <div class="d-flex align-items-center" style="gap: 8px;">
        <button class="btn btn-help" data-bs-toggle="modal" data-bs-target="#helpModal">Help</button>
        <button class="btn btn-settings" data-bs-toggle="modal" data-bs-target="#formSettingsModal">Form Settings</button>
      </div>
    </div>

    <div class="row">
      <!-- Toolbox Column -->
      <div class="col-md-3 mb-3">
        <div class="toolbox-section" aria-label="Toolbox: Drag items to create your form">
          <h5 class="text-primary mb-2">Toolbox</h5>
          <p class="text-muted mb-3">Drag an item into the form area</p>
          <!-- Widgets -->
          <div class="draggable-item" data-type="title" role="button" tabindex="0">Title (Heading)</div>
          <div class="draggable-item" data-type="paragraph" role="button" tabindex="0">Content (Paragraph)</div>
          <!-- Basic Inputs -->
          <div class="draggable-item" data-type="text" role="button" tabindex="0">Text</div>
          <div class="draggable-item" data-type="email" role="button" tabindex="0">Email</div>
          <div class="draggable-item" data-type="password" role="button" tabindex="0">Password</div>
          <div class="draggable-item" data-type="number" role="button" tabindex="0">Number</div>
          <div class="draggable-item" data-type="date" role="button" tabindex="0">Date</div>
          <div class="draggable-item" data-type="time" role="button" tabindex="0">Time</div>
          <div class="draggable-item" data-type="range" role="button" tabindex="0">Range</div>
          <!-- Multiple Choice Inputs -->
          <div class="draggable-item" data-type="checkbox" role="button" tabindex="0">Checkbox(es)</div>
          <div class="draggable-item" data-type="radio" role="button" tabindex="0">Radio Group</div>
          <div class="draggable-item" data-type="select" role="button" tabindex="0">Dropdown</div>
          <!-- Textarea Input -->
          <div class="draggable-item" data-type="textarea" role="button" tabindex="0">Textarea</div>
          <!-- Submit Button -->
          <div class="draggable-item" data-type="submit" role="button" tabindex="0">Submit Button</div>
        </div>
      </div>

      <!-- Form Builder Column -->
      <div class="col-md-9">
        <div class="builder-section" id="form-builder" aria-label="Form Builder Area: Drop items here">
          <h5 class="text-primary mb-2">Form Builder Area</h5>
          <p class="text-muted">Drop items here to create your form</p>
        </div>
      </div>
    </div>

    <!-- Generate and Preview Buttons -->
    <div class="d-flex justify-content-end mt-3" style="gap: 8px;">
      <button class="btn btn-morweb-green" id="generate-btn">Generate Form</button>
      <button class="btn btn-outline-secondary" id="preview-btn">Preview</button>
    </div>

    <!-- Generated Code Display -->
    <div id="generated-container" class="mt-4">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h6 class="text-primary mb-0">Generated Form HTML + CSS</h6>
        <button class="btn btn-outline-secondary" id="copy-code-btn">Copy Code</button>
      </div>
      <div id="generated-code"></div>
    </div>
  </div>

  <!-- Preview Modal -->
  <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="previewModalLabel">Form Preview</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Device Toggle Buttons -->
          <div class="d-flex mb-3">
            <button class="btn btn-outline-secondary btn-sm preview-device-btn" data-device="desktop">Desktop</button>
            <button class="btn btn-outline-secondary btn-sm preview-device-btn" data-device="tablet">Tablet</button>
            <button class="btn btn-outline-secondary btn-sm preview-device-btn" data-device="mobile">Mobile</button>
          </div>
          <!-- Form Preview Container -->
          <div id="form-preview"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="helpModalLabel">Form Builder Help</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6>How to Use the Form Builder</h6>
          <p>Welcome to the Drag &amp; Drop Form Builder! Follow these steps to create your custom forms:</p>
          <ol>
            <li><strong>Choose a Prebuilt Form or Start from Scratch:</strong> Use the dropdown menu at the top and click "Load".</li>
            <li><strong>Set Form Settings:</strong> Click "Form Settings" to configure global properties such as action URL, method, form ID, CSS classes, primary color, layout, and now additional theme options (background color, text color, and font family).</li>
            <li><strong>Drag and Drop Elements:</strong> From the Toolbox on the left, drag any form element into the Form Builder Area.</li>
            <li><strong>Configure Fields:</strong> After dropping an element, a modal will appear to set properties such as label, name, placeholder, and extra options.</li>
            <li><strong>Rearrange Fields:</strong> Use the drag handle (☰) to reorder fields.</li>
            <li><strong>Generate the Form:</strong> Click "Generate Form" to produce the HTML + CSS code.</li>
            <li><strong>Preview Your Form:</strong> Click "Preview" to see a live preview with device toggles for Desktop, Tablet, and Mobile views.</li>
            <li><strong>Copy the Code:</strong> Use "Copy Code" to copy the generated code for embedding.</li>
          </ol>
          <h6>Tips for Effective Forms</h6>
          <ul>
            <li><strong>Keep It Simple:</strong> Include only necessary fields.</li>
            <li><strong>Clear Labels:</strong> Ensure each field has a descriptive label.</li>
            <li><strong>Validation:</strong> Use required fields and provide clear validation messages.</li>
            <li><strong>Responsive Design:</strong> Make sure your form looks good on all devices.</li>
          </ul>
          <h6>Troubleshooting</h6>
          <ul>
            <li><strong>Form Not Displaying Correctly:</strong> Verify that Bootstrap CSS is properly linked.</li>
            <li><strong>Copy Functionality Issues:</strong> If "Copy Code" fails, try manually copying the code.</li>
            <li><strong>Missing Fields:</strong> Confirm that all desired fields are added in the builder.</li>
          </ul>
          <p>If you need further help, please contact our support team.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Form Settings Modal with Enhanced Global Theme Options -->
  <div class="modal fade" id="formSettingsModal" tabindex="-1" aria-labelledby="formSettingsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <form id="form-settings-form">
          <div class="modal-header">
            <h5 class="modal-title" id="formSettingsModalLabel">Form Settings</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- Global Form Settings -->
            <div class="mb-3">
              <label for="form-action" class="form-label">Form Action URL</label>
              <input type="url" class="form-control" id="form-action" placeholder="https://yourdomain.com/submit-form">
              <small class="form-text text-muted">URL where form data will be sent.</small>
            </div>
            <div class="mb-3">
              <label for="form-method" class="form-label">Form Method</label>
              <select class="form-select" id="form-method">
                <option value="post" selected>POST</option>
                <option value="get">GET</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="form-id" class="form-label">Form ID</label>
              <input type="text" class="form-control" id="form-id" placeholder="e.g., contact-form">
              <small class="form-text text-muted">Unique identifier for the form.</small>
            </div>
            <div class="mb-3">
              <label for="form-class" class="form-label">Form Classes</label>
              <input type="text" class="form-control" id="form-class" placeholder="e.g., my-custom-form">
              <small class="form-text text-muted">Additional CSS classes for styling.</small>
            </div>
            <div class="mb-3">
              <label for="form-primary-color" class="form-label">Primary Color</label>
              <input type="color" class="form-control form-control-color" id="form-primary-color" value="#00a99d" title="Choose your primary color">
              <small class="form-text text-muted">Select the primary color for form elements.</small>
            </div>
            <!-- New Theme Editor Options -->
            <div class="mb-3">
              <label for="form-background-color" class="form-label">Form Background Color</label>
              <input type="color" class="form-control form-control-color" id="form-background-color" value="#ffffff" title="Choose your form's background color">
              <small class="form-text text-muted">Select the background color for your form.</small>
            </div>
            <div class="mb-3">
              <label for="form-text-color" class="form-label">Form Text Color</label>
              <input type="color" class="form-control form-control-color" id="form-text-color" value="#333333" title="Choose your form's text color">
              <small class="form-text text-muted">Select the text color for your form.</small>
            </div>
            <div class="mb-3">
              <label for="form-font-family" class="form-label">Form Font Family</label>
              <select class="form-select" id="form-font-family">
                <option value="Verdana, Geneva, sans-serif" selected>Verdana</option>
                <option value="Arial, Helvetica, sans-serif">Arial</option>
                <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
                <option value="'Times New Roman', Times, serif">Times New Roman</option>
              </select>
              <small class="form-text text-muted">Choose a font for your form.</small>
            </div>
            <div class="mb-3">
              <label for="form-aria-label" class="form-label">ARIA Label</label>
              <input type="text" class="form-control" id="form-aria-label" placeholder="Descriptive label for assistive tech">
              <small class="form-text text-muted">Provides an accessible name for the form.</small>
            </div>
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="form-aria-hidden">
              <label class="form-check-label" for="form-aria-hidden">Hide form from assistive technologies (Not recommended)</label>
            </div>
            <div class="mb-3">
              <label for="form-layout" class="form-label">Form Layout</label>
              <select class="form-select" id="form-layout">
                <option value="one-column" selected>One Column</option>
                <option value="two-column">Two Column</option>
                <option value="inline">Inline</option>
              </select>
              <small class="form-text text-muted">Choose how form fields are arranged.</small>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-morweb-green">Save Settings</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Field Configuration Modal -->
  <div class="modal fade" id="fieldConfigModal" tabindex="-1" aria-labelledby="fieldConfigModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="config-form">
          <div class="modal-header">
            <h5 class="modal-title" id="fieldConfigModalLabel">Configure Field</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- Dynamically injected configuration fields -->
            <div class="mb-3" id="base-config"></div>
            <div id="additional-options" class="mt-3"></div>
            <div id="placeholder-option" class="mt-3"></div>
            <div id="range-options" class="mt-3"></div>
            <div id="textarea-options" class="mt-3"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-morweb-green">Save Field</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Hidden dialog for state storage if needed -->
  <div id="field-config-dialog" title="Configure Field" style="display: none;"></div>

  <script>
    // Prebuilt Forms Data
    const prebuiltForms = {
      scratch: [],
      contact: [
        { fieldType: 'title', label: 'Contact Us', headingLevel: 'h3', name: '', required: false, extraOptions: '', placeholder: '', paragraphText: '' },
        { fieldType: 'paragraph', label: '', headingLevel: '', name: '', required: false, extraOptions: '', placeholder: '', paragraphText: 'We would love to hear from you! Please fill out the form below and we will get back to you shortly.' },
        { fieldType: 'text', label: 'Name', name: 'name', required: true, extraOptions: '', placeholder: 'Enter your full name', headingLevel: '', paragraphText: '' },
        { fieldType: 'email', label: 'Email', name: 'email', required: true, extraOptions: '', placeholder: 'example@domain.com', headingLevel: '', paragraphText: '' },
        { fieldType: 'text', label: 'Subject', name: 'subject', required: false, extraOptions: '', placeholder: 'Subject of your message', headingLevel: '', paragraphText: '' },
        { fieldType: 'submit', label: 'Submit', name: 'submit_btn', required: false, extraOptions: '', placeholder: '', headingLevel: '', paragraphText: '' }
      ],
      registration: [
        { fieldType: 'title', label: 'Register Now', headingLevel: 'h3', name: '', required: false, extraOptions: '', placeholder: '', paragraphText: '' },
        { fieldType: 'text', label: 'Username', name: 'username', required: true, extraOptions: '', placeholder: 'Choose a unique username', headingLevel: '', paragraphText: '' },
        { fieldType: 'email', label: 'Email', name: 'email', required: true, extraOptions: '', placeholder: 'example@domain.com', headingLevel: '', paragraphText: '' },
        { fieldType: 'password', label: 'Password', name: 'password', required: true, extraOptions: '', placeholder: 'Create a password', headingLevel: '', paragraphText: '' },
        { fieldType: 'radio', label: 'Gender', name: 'gender', required: false, extraOptions: 'Male, Female, Other', placeholder: '', headingLevel: '', paragraphText: '' },
        { fieldType: 'select', label: 'Country', name: 'country', required: false, extraOptions: 'USA, Canada, UK, Other', placeholder: '', headingLevel: '', paragraphText: '' },
        { fieldType: 'submit', label: 'Register', name: 'register_btn', required: false, extraOptions: '', placeholder: '', headingLevel: '', paragraphText: '' }
      ],
      feedback: [
        { fieldType: 'title', label: 'Feedback', headingLevel: 'h3', name: '', required: false, extraOptions: '', placeholder: '', paragraphText: '' },
        { fieldType: 'text', label: 'Name', name: 'name', required: true, extraOptions: '', placeholder: 'Enter your name', headingLevel: '', paragraphText: '' },
        { fieldType: 'email', label: 'Email', name: 'email', required: true, extraOptions: '', placeholder: 'example@domain.com', headingLevel: '', paragraphText: '' },
        { fieldType: 'range', label: 'Rating (1-10)', name: 'rating', required: false, extraOptions: '', placeholder: '', headingLevel: '', paragraphText: '', min: 1, max: 10, step: 1, defaultValue: 5 },
        { fieldType: 'textarea', label: 'Comments', name: 'comments', required: false, extraOptions: '', placeholder: 'Your feedback...', headingLevel: '', paragraphText: '', textareaRows: 4, textareaPlaceholder: 'Your feedback...' },
        { fieldType: 'submit', label: 'Submit Feedback', name: 'submit_feedback', required: false, extraOptions: '', placeholder: '', headingLevel: '', paragraphText: '' }
      ],
      volunteer: [
        { fieldType: 'title', label: 'Join Our Team', headingLevel: 'h3', name: '', required: false, extraOptions: '', placeholder: '', paragraphText: '' },
        { fieldType: 'paragraph', label: '', headingLevel: '', name: '', required: false, extraOptions: '', placeholder: '', paragraphText: 'We appreciate your interest in volunteering. Please provide the following information:' },
        { fieldType: 'text', label: 'Name', name: 'name', required: true, extraOptions: '', placeholder: 'Your full name', headingLevel: '', paragraphText: '' },
        { fieldType: 'email', label: 'Email', name: 'email', required: true, extraOptions: '', placeholder: 'example@domain.com', headingLevel: '', paragraphText: '' },
        { fieldType: 'text', label: 'Phone Number', name: 'phone_number', required: false, extraOptions: '', placeholder: 'e.g., (123) 456-7890', headingLevel: '', paragraphText: '' },
        { fieldType: 'checkbox', label: 'Areas of Interest', name: 'areas_of_interest', required: false, extraOptions: 'Fundraising, Community Outreach, Event Management, Administrative Support, Other', placeholder: '', headingLevel: '', paragraphText: '' },
        { fieldType: 'text', label: 'Availability', name: 'availability', required: false, extraOptions: '', placeholder: 'e.g., Weekends, Evenings', headingLevel: '', paragraphText: '' },
        { fieldType: 'submit', label: 'Submit', name: 'submit_volunteer', required: false, extraOptions: '', placeholder: '', headingLevel: '', paragraphText: '' }
      ],
      appointment: [
        { fieldType: 'title', label: 'Request an Appointment', headingLevel: 'h3', name: '', required: false, extraOptions: '', placeholder: '', paragraphText: '' },
        { fieldType: 'paragraph', label: '', headingLevel: '', name: '', required: false, extraOptions: '', placeholder: '', paragraphText: 'Please fill out the form below to request an appointment. We will get back to you shortly to confirm the details.' },
        { fieldType: 'text', label: 'Full Name', name: 'full_name', required: true, extraOptions: '', placeholder: 'Enter your full name', headingLevel: '', paragraphText: '' },
        { fieldType: 'email', label: 'Email Address', name: 'email', required: true, extraOptions: '', placeholder: 'example@domain.com', headingLevel: '', paragraphText: '' },
        { fieldType: 'text', label: 'Phone Number', name: 'phone_number', required: false, extraOptions: '', placeholder: 'e.g., (123) 456-7890', headingLevel: '', paragraphText: '' },
        { fieldType: 'date', label: 'Preferred Appointment Date', name: 'appointment_date', required: true, extraOptions: '', placeholder: '', headingLevel: '', paragraphText: '' },
        { fieldType: 'time', label: 'Preferred Appointment Time', name: 'appointment_time', required: true, extraOptions: '', placeholder: '', headingLevel: '', paragraphText: '' },
        { fieldType: 'select', label: 'Purpose of Appointment', name: 'appointment_purpose', required: true, extraOptions: 'Consultation, Follow-up, General Inquiry, Other', placeholder: '', headingLevel: '', paragraphText: '' },
        { fieldType: 'textarea', label: 'Additional Notes', name: 'additional_notes', required: false, extraOptions: '', placeholder: '', headingLevel: '', paragraphText: '', textareaRows: 4, textareaPlaceholder: 'Any specific requirements or information...' },
        { fieldType: 'submit', label: 'Request Appointment', name: 'submit_appointment', required: false, extraOptions: '', placeholder: '', headingLevel: '', paragraphText: '' }
      ]
    };

    // Global Form Settings (Default Values, including new theme options)
    let globalFormSettings = {
      action: '',
      method: 'post',
      id: '',
      class: '',
      primaryColor: '#00a99d',
      backgroundColor: '#ffffff',
      textColor: '#333333',
      fontFamily: 'Verdana, Geneva, sans-serif',
      ariaLabel: '',
      ariaHidden: false,
      formLayout: 'one-column'
    };

    $(function() {
      // Apply initial primary color to builder interface
      $(':root').css('--bs-primary', globalFormSettings.primaryColor);

      // Make toolbox items draggable
      $('.draggable-item').draggable({
        helper: 'clone',
        revert: 'invalid',
        start: function(event, ui) { $(ui.helper).css('z-index', '1000'); }
      });

      // Make form builder droppable
      $('#form-builder').droppable({
        accept: '.draggable-item',
        drop: function(event, ui) {
          const fieldType = ui.draggable.data('type');
          openConfigModal(fieldType, null);
        }
      });

      // Enable sorting within form builder
      $('#form-builder').sortable({ handle: '.drag-handle' });

      // Field configuration form submission
      $('#config-form').on('submit', function(e) {
        e.preventDefault();
        const $modal = $('#fieldConfigModal');
        const fieldType = $modal.data('fieldType');
        const $targetEl = $modal.data('$targetEl'); 
        let label = $('#field-label').val() || '';
        let name = $('#field-name').val() || '';
        let required = $('#field-required').is(':checked');
        let extraOptions = $('#extra-options').val() || '';
        let headingLevel = $('#heading-level').val() || 'h3';
        let paragraphText = $('#paragraph-text').val() || '';
        let placeholder = $('#field-placeholder').val() || '';
        let textareaRows = $('#textarea-rows').val() || 4;
        let textareaPlaceholder = $('#textarea-placeholder').val() || '';
        let rangeMin = $('#range-min').val() || 0;
        let rangeMax = $('#range-max').val() || 100;
        let rangeStep = $('#range-step').val() || 1;
        let rangeDefault = $('#range-default').val() || '';
        let configData = { fieldType, label, name, required, extraOptions, headingLevel, paragraphText, placeholder, textareaRows, textareaPlaceholder, rangeMin, rangeMax, rangeStep, rangeDefault };
        if ($targetEl) { updateFieldElement($targetEl, configData); }
        else { createFieldElement(configData); }
        const modalEl = document.getElementById('fieldConfigModal');
        const modal = bootstrap.Modal.getInstance(modalEl);
        modal.hide();
        $('#base-config, #additional-options, #placeholder-option, #range-options, #textarea-options').empty();
        $(this)[0].reset();
      });

      // Generate Form Button
      $('#generate-btn').on('click', function() {
        let $clone = $('#form-builder').clone();
        $clone.find('.field-toolbar').remove();
        let builderHtml = $clone.html().trim();
        const currentPrimaryColor = globalFormSettings.primaryColor;
        const layoutType = globalFormSettings.formLayout;
        let layoutClass = (layoutType === 'two-column') ? 'two-column' : (layoutType === 'inline' ? 'inline-form' : 'one-column');
        let formAttributes = '';
        formAttributes += globalFormSettings.id ? ` id="${globalFormSettings.id}"` : ' id="my-generated-form"';
        let classes = 'my-generated-form-wrapper ' + (globalFormSettings.class ? globalFormSettings.class + ' ' : '') + layoutClass;
        formAttributes += ` class="${classes}"`;
        formAttributes += globalFormSettings.action ? ` action="${globalFormSettings.action}"` : '';
        formAttributes += ` method="${globalFormSettings.method}"`;
        formAttributes += globalFormSettings.ariaLabel ? ` aria-label="${globalFormSettings.ariaLabel}"` : '';
        formAttributes += globalFormSettings.ariaHidden ? ' aria-hidden="true"' : '';
        
        let cssContent = `
/* Generated Form Styling */
.my-generated-form-wrapper {
  max-width: 800px;
  margin: auto;
  padding: 15px;
  background-color: ${globalFormSettings.backgroundColor};
  color: ${globalFormSettings.textColor};
  font-family: ${globalFormSettings.fontFamily};
  border-radius: 5px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}
.my-generated-form-wrapper::after {
  content: "";
  display: block;
  clear: both;
}
.my-generated-form-wrapper .form-element-wrapper {
  width: 100%;
  margin-bottom: 1rem;
  box-sizing: border-box;
}
.my-generated-form-wrapper label.form-label {
  font-weight: 600;
  margin-bottom: 0.5rem;
  display: block;
  color: var(--bs-text-color);
}
.my-generated-form-wrapper input.form-control,
.my-generated-form-wrapper select.form-select,
.my-generated-form-wrapper textarea.form-control {
  padding: 8px 10px;
  border-radius: 4px;
  border: 1px solid #ced4da;
  transition: border-color 0.3s, box-shadow 0.3s;
}
.my-generated-form-wrapper input.form-control:focus,
.my-generated-form-wrapper select.form-select:focus,
.my-generated-form-wrapper textarea.form-control:focus {
  border-color: ${currentPrimaryColor};
  box-shadow: 0 0 0 0.2rem rgba(0, 169, 157, 0.25);
}
.my-generated-form-wrapper .btn-primary {
  background-color: ${currentPrimaryColor};
  border-color: ${currentPrimaryColor};
  color: #ffffff;
  padding: 6px 12px;
  border-radius: 4px;
  font-weight: 600;
  transition: background-color 0.3s, border-color 0.3s;
}
.my-generated-form-wrapper .btn-primary:hover {
  background-color: #008e7f;
  border-color: #008e7f;
  color: #ffffff;
}
.my-generated-form-wrapper .form-check-input:focus {
  border-color: ${currentPrimaryColor};
  box-shadow: 0 0 0 0.2rem rgba(0, 169, 157, 0.25);
}
.my-generated-form-wrapper select.form-select option[disabled][selected] {
  color: #6c757d;
}
.my-generated-form-wrapper p {
  font-size: 0.95rem;
  color: var(--bs-text-color);
}
.my-generated-form-wrapper.two-column {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}
.my-generated-form-wrapper.inline-form {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 1rem;
}
        `;
        
        let finalFormHtml = `<form${formAttributes}>${builderHtml}</form>`;
        let finalCodeSnippet = `<style>${cssContent}</style>\n\n${finalFormHtml}`;
        $('#generated-code').text(finalCodeSnippet);
        if ($('#generated-form-style').length) {
          $('#generated-form-style').text(cssContent);
        } else {
          $('head').append(`<style id="generated-form-style">${cssContent}</style>`);
        }
      });

      // Copy Code Button using Clipboard API
      $('#copy-code-btn').on('click', function() {
        let code = $('#generated-code').text();
        if (!code) { alert('No code to copy. Please generate the form first.'); return; }
        if (navigator.clipboard) {
          navigator.clipboard.writeText(code)
            .then(() => { $(this).text('Copied!'); setTimeout(() => { $(this).text('Copy Code'); }, 2000); })
            .catch(() => { alert('Failed to copy code. Please try manually.'); });
        } else {
          let tempTextArea = document.createElement('textarea');
          tempTextArea.value = code;
          document.body.appendChild(tempTextArea);
          tempTextArea.select();
          document.execCommand('copy');
          document.body.removeChild(tempTextArea);
          $(this).text('Copied!');
          setTimeout(() => { $(this).text('Copy Code'); }, 2000);
        }
      });

      // Preview Button with Device Toggles and Card Layout
      $('#preview-btn').on('click', function() {
        let formHtml = $('#generated-code').text();
        if (!formHtml) { alert('Please generate the form before previewing.'); return; }
        // Wrap the generated form in a card container for preview
        $('#form-preview').html('<div class="form-preview-card">' + formHtml + '</div>');
        if (!$('#previewStyles').length) {
          let styleTag = `<style id="previewStyles">${$('#generated-form-style').text()}</style>`;
          $('#form-preview').prepend(styleTag);
        }
        let previewModal = new bootstrap.Modal(document.getElementById('previewModal'));
        previewModal.show();
      });

      // Device Toggle Handler for Preview Modal
      document.addEventListener('click', function(e) {
        if (e.target.matches('[data-device]')) {
          const device = e.target.getAttribute('data-device');
          const $previewContainer = $('#form-preview');
          if (device === 'desktop') {
            $previewContainer.css('width', '100%');
          } else if (device === 'tablet') {
            $previewContainer.css('width', '768px');
          } else if (device === 'mobile') {
            $previewContainer.css('width', '375px');
          }
        }
      });

      // Load Prebuilt Form
      $('#load-prebuilt').on('click', function() {
        let selection = $('#prebuilt-form-select').val();
        loadPrebuiltForm(selection);
      });
      function loadPrebuiltForm(formKey) {
        $('#form-builder').empty();
        resetGlobalFormSettings();
        if (formKey === 'scratch') return;
        let fields = prebuiltForms[formKey] || [];
        fields.forEach(cfg => createFieldElement(cfg));
      }

      // Create/Update Field Elements
      function createFieldElement(configData) {
        const $wrapper = $(`
          <div class="form-element-wrapper">
            <div class="field-content"></div>
            <div class="field-toolbar">
              <span class="drag-handle" title="Drag to reorder" tabindex="0" aria-label="Drag to reorder">&#x2630;</span>
              <button type="button" class="btn btn-sm btn-outline-primary edit-btn" aria-label="Edit field">Edit</button>
              <button type="button" class="btn btn-sm btn-outline-danger delete-btn" aria-label="Delete field">Delete</button>
            </div>
          </div>
        `);
        $wrapper.data('fieldConfig', configData);
        let fieldHtml = generateFieldMarkup(configData);
        $wrapper.find('.field-content').html(fieldHtml);
        $('#form-builder').append($wrapper);
        bindToolbarEvents($wrapper);
      }
      function updateFieldElement($wrapper, configData) {
        $wrapper.data('fieldConfig', configData);
        let fieldHtml = generateFieldMarkup(configData);
        $wrapper.find('.field-content').html(fieldHtml);
      }
      function bindToolbarEvents($wrapper) {
        $wrapper.find('.edit-btn').on('click', function() {
          let configData = $wrapper.data('fieldConfig');
          openConfigModal(configData.fieldType, $wrapper);
        });
        $wrapper.find('.delete-btn').on('click', function() {
          if (confirm('Are you sure you want to delete this field?')) { $wrapper.remove(); }
        });
        $wrapper.find('.drag-handle').on('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); }
        });
      }

      // Open Field Configuration Modal
      function openConfigModal(fieldType, $targetEl) {
        const modalEl = document.getElementById('fieldConfigModal');
        const modal = new bootstrap.Modal(modalEl, {});
        $('#fieldConfigModal').data('fieldType', fieldType);
        $('#fieldConfigModal').data('$targetEl', $targetEl);
        $('#base-config, #additional-options, #placeholder-option, #range-options, #textarea-options').empty();
        if ($targetEl) { let existingConfig = $targetEl.data('fieldConfig'); populateModalFields(existingConfig); }
        else { populateModalFields({ fieldType }); }
        modal.show();
      }

      // Populate Modal Fields for Field Configuration
      function populateModalFields(config) {
        const { fieldType = '', label = '', name = '', required = false, extraOptions = '',
          headingLevel = 'h3', paragraphText = '', placeholder = '', textareaRows = 4, textareaPlaceholder = '',
          rangeMin = '', rangeMax = '', rangeStep = '', rangeDefault = '' } = config;
        const placeholderSupportedTypes = ['text', 'email', 'password', 'number', 'range'];
        const supportsPlaceholder = placeholderSupportedTypes.includes(fieldType);
        if (supportsPlaceholder) {
          $('#placeholder-option').html(`
            <div class="mb-3">
              <label for="field-placeholder" class="form-label">Placeholder</label>
              <input type="text" class="form-control" id="field-placeholder" placeholder="Enter placeholder text">
            </div>
          `);
          $('#field-placeholder').val(placeholder);
        }
        if (fieldType === 'textarea') {
          $('#textarea-options').html(`
            <div class="mb-3">
              <label for="textarea-rows" class="form-label">Number of Rows</label>
              <input type="number" class="form-control" id="textarea-rows" min="2" max="10">
            </div>
            <div class="mb-3">
              <label for="textarea-placeholder" class="form-label">Textarea Placeholder</label>
              <input type="text" class="form-control" id="textarea-placeholder" placeholder="Enter placeholder text">
            </div>
          `);
          $('#textarea-rows').val(textareaRows);
          $('#textarea-placeholder').val(textareaPlaceholder);
        }
        if (fieldType === 'range') {
          $('#range-options').html(`
            <div class="mb-3">
              <label for="range-min" class="form-label">Minimum Value</label>
              <input type="number" class="form-control" id="range-min" value="${rangeMin || 0}">
            </div>
            <div class="mb-3">
              <label for="range-max" class="form-label">Maximum Value</label>
              <input type="number" class="form-control" id="range-max" value="${rangeMax || 100}">
            </div>
            <div class="mb-3">
              <label for="range-step" class="form-label">Step</label>
              <input type="number" class="form-control" id="range-step" value="${rangeStep || 1}">
            </div>
            <div class="mb-3">
              <label for="range-default" class="form-label">Default Value</label>
              <input type="number" class="form-control" id="range-default" value="${rangeDefault || (rangeMin || 0)}">
            </div>
          `);
          $('#range-min').val(rangeMin || 0);
          $('#range-max').val(rangeMax || 100);
          $('#range-step').val(rangeStep || 1);
          $('#range-default').val(rangeDefault || (rangeMin || 0));
        }
        if (fieldType === 'title') {
          $('#base-config').html(`
            <div class="mb-3">
              <label for="heading-level" class="form-label">Heading Level</label>
              <select class="form-select" id="heading-level" name="heading-level">
                <option value="h1"${headingLevel === 'h1' ? ' selected' : ''}>H1</option>
                <option value="h2"${headingLevel === 'h2' ? ' selected' : ''}>H2</option>
                <option value="h3"${headingLevel === 'h3' ? ' selected' : ''}>H3</option>
                <option value="h4"${headingLevel === 'h4' ? ' selected' : ''}>H4</option>
                <option value="h5"${headingLevel === 'h5' ? ' selected' : ''}>H5</option>
                <option value="h6"${headingLevel === 'h6' ? ' selected' : ''}>H6</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="field-label" class="form-label">Title Text</label>
              <input type="text" class="form-control" id="field-label" required>
            </div>
          `);
          $('#field-label').val(label);
        }
        else if (fieldType === 'paragraph') {
          $('#base-config').html(`
            <div class="mb-3">
              <label for="paragraph-text" class="form-label">Paragraph Text</label>
              <textarea class="form-control" id="paragraph-text" rows="3" required></textarea>
            </div>
          `);
          $('#paragraph-text').val(paragraphText);
        }
        else if (fieldType === 'submit') {
          $('#base-config').html(`
            <div class="mb-3">
              <label for="field-label" class="form-label">Button Text</label>
              <input type="text" class="form-control" id="field-label" required>
            </div>
            <div class="mb-3">
              <label for="field-name" class="form-label">Name Attribute</label>
              <input type="text" class="form-control" id="field-name" required>
            </div>
          `);
          $('#field-label').val(label);
          $('#field-name').val(name);
          $('#field-label').on('input', function() {
            let rawLabel = $(this).val();
            let autoName = rawLabel.toLowerCase().replace(/\W+/g, '_').replace(/^_+|_+$/g, '');
            $('#field-name').val(autoName);
          });
        }
        else {
          $('#base-config').html(`
            <div class="mb-3">
              <label for="field-label" class="form-label">Label</label>
              <input type="text" class="form-control" id="field-label" required>
            </div>
            <div class="mb-3">
              <label for="field-name" class="form-label">Name</label>
              <input type="text" class="form-control" id="field-name" required>
            </div>
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="field-required">
              <label class="form-check-label" for="field-required">Required?</label>
            </div>
          `);
          $('#field-label').val(label);
          $('#field-name').val(name);
          if (required) { $('#field-required').prop('checked', true); }
          if (['checkbox', 'radio', 'select'].includes(fieldType)) {
            $('#additional-options').html(`
              <label for="extra-options" class="form-label">Options (comma separated)</label>
              <input type="text" class="form-control" id="extra-options" placeholder="Option1, Option2, Option3" />
            `);
            $('#extra-options').val(extraOptions);
          }
          $('#field-label').on('input', function() {
            let rawLabel = $(this).val();
            let autoName = rawLabel.toLowerCase().replace(/\W+/g, '_').replace(/^_+|_+$/g, '');
            $('#field-name').val(autoName);
          });
        }
      }

      // Generate HTML for Field Based on Configuration
      function generateFieldMarkup(config) {
        const { fieldType, label, name, required, extraOptions, headingLevel, paragraphText,
                placeholder, textareaRows, textareaPlaceholder, rangeMin, rangeMax, rangeStep, rangeDefault } = config;
        let requiredAttr = required ? ' required aria-required="true"' : '';
        let requiredIndicator = required ? ' <span class="text-danger">*</span>' : '';
        let uniqueId = `${name}_${Math.random().toString(36).substr(2, 9)}`;
        let labelId = `${uniqueId}_label`;
        let placeholderAttr = placeholder && ['text','email','password','number','range'].includes(fieldType)
          ? ` placeholder="${placeholder}"` : '';
        let html = '';
        switch (fieldType) {
          case 'title':
            html = `<${headingLevel} class="text-primary mb-3" id="${uniqueId}">${label}</${headingLevel}>`;
            break;
          case 'paragraph':
            html = `<p class="mb-3" id="${uniqueId}">${paragraphText}</p>`;
            break;
          case 'submit':
            html = `
              <button type="submit"
                      name="${name}"
                      class="btn btn-primary"
                      id="${uniqueId}"
                      aria-label="${label}">
                ${label}
              </button>
            `;
            break;
          case 'text':
          case 'email':
          case 'password':
          case 'number':
          case 'date':
          case 'time':
          case 'color':
            html = `
              <label for="${uniqueId}" class="form-label" id="${labelId}">
                ${label}${requiredIndicator}
              </label>
              <input type="${fieldType}"
                     class="form-control"
                     id="${uniqueId}"
                     name="${name}"
                     ${requiredAttr}
                     aria-labelledby="${labelId}"
                     ${placeholderAttr}/>
            `;
            break;
          case 'range': {
            let valNow = rangeDefault || rangeMin || 0;
            html = `
              <label for="${uniqueId}" class="form-label" id="${labelId}">
                ${label}${requiredIndicator}
              </label>
              <input type="range"
                     class="form-range"
                     id="${uniqueId}"
                     name="${name}"
                     min="${rangeMin || 0}"
                     max="${rangeMax || 100}"
                     step="${rangeStep || 1}"
                     value="${valNow}"
                     ${requiredAttr}
                     aria-labelledby="${labelId}"
                     aria-valuemin="${rangeMin || 0}"
                     aria-valuemax="${rangeMax || 100}"
                     aria-valuenow="${valNow}"/>
              <div class="form-text">Value:
                <span id="${uniqueId}_value">${valNow}</span>
              </div>
            `;
            break;
          }
          case 'textarea':
            html = `
              <label for="${uniqueId}" class="form-label" id="${labelId}">
                ${label}${requiredIndicator}
              </label>
              <textarea class="form-control"
                        id="${uniqueId}"
                        name="${name}"
                        rows="${textareaRows}"
                        ${requiredAttr}
                        aria-labelledby="${labelId}"
                        placeholder="${textareaPlaceholder}"></textarea>
            `;
            break;
          case 'checkbox': {
            let checkboxOptions = extraOptions.split(',').map(opt => opt.trim());
            let legendId = `${uniqueId}_legend`;
            let checkboxesHtml = checkboxOptions.map(opt => {
              let cbId = `${name}_${opt.replace(/\s+/g, '_').toLowerCase()}_${Math.random().toString(36).substr(2, 5)}`;
              return `
                <div class="form-check">
                  <input class="form-check-input"
                         type="checkbox"
                         id="${cbId}"
                         name="${name}[]"
                         value="${opt}"
                         ${requiredAttr}>
                  <label class="form-check-label" for="${cbId}">${opt}</label>
                </div>
              `;
            }).join('\n');
            html = `
              <fieldset class="mb-3" id="${uniqueId}" aria-labelledby="${legendId}">
                <legend class="col-form-label pt-0" id="${legendId}">
                  ${label}${requiredIndicator}
                </legend>
                ${checkboxesHtml}
              </fieldset>
            `;
            break;
          }
          case 'radio': {
            let radioOptions = extraOptions.split(',').map(opt => opt.trim());
            let legendId = `${uniqueId}_legend`;
            let radiosHtml = radioOptions.map(opt => {
              let radioId = `${name}_${opt.replace(/\s+/g, '_').toLowerCase()}_${Math.random().toString(36).substr(2, 5)}`;
              return `
                <div class="form-check">
                  <input class="form-check-input"
                         type="radio"
                         id="${radioId}"
                         name="${name}"
                         value="${opt}"
                         ${requiredAttr}>
                  <label class="form-check-label" for="${radioId}">${opt}</label>
                </div>
              `;
            }).join('\n');
            html = `
              <fieldset class="mb-3" id="${uniqueId}" aria-labelledby="${legendId}">
                <legend class="col-form-label pt-0" id="${legendId}">
                  ${label}${requiredIndicator}
                </legend>
                ${radiosHtml}
              </fieldset>
            `;
            break;
          }
          case 'select': {
            let selectOptions = extraOptions.split(',').map(opt => opt.trim());
            let optionsHtml = selectOptions.map(opt => `<option value="${opt}">${opt}</option>`).join('\n');
            html = `
              <label for="${uniqueId}" class="form-label" id="${labelId}">
                ${label}${requiredIndicator}
              </label>
              <select class="form-select"
                      id="${uniqueId}"
                      name="${name}"
                      ${requiredAttr}
                      aria-labelledby="${labelId}">
                <option value="" disabled selected>Select an option</option>
                ${optionsHtml}
              </select>
            `;
            break;
          }
          default:
            html = `
              <label for="${uniqueId}" class="form-label" id="${labelId}">
                ${label}${requiredIndicator}
              </label>
              <input type="text"
                     class="form-control"
                     id="${uniqueId}"
                     name="${name}"
                     ${requiredAttr}
                     aria-labelledby="${labelId}" />
            `;
            break;
        }
        return html;
      }

      // Reset Global Form Settings to Defaults
      function resetGlobalFormSettings() {
        globalFormSettings = {
          action: '',
          method: 'post',
          id: '',
          class: '',
          primaryColor: '#00a99d',
          backgroundColor: '#ffffff',
          textColor: '#333333',
          fontFamily: 'Verdana, Geneva, sans-serif',
          ariaLabel: '',
          ariaHidden: false,
          formLayout: 'one-column'
        };
        $(':root').css('--bs-primary', globalFormSettings.primaryColor);
      }

      // Form Settings Modal Submission
      $('#form-settings-form').on('submit', function(e) {
        e.preventDefault();
        let action = $('#form-action').val() || '';
        let method = $('#form-method').val() || 'post';
        let id = $('#form-id').val() || '';
        let className = $('#form-class').val() || '';
        let primaryColor = $('#form-primary-color').val() || '#00a99d';
        let backgroundColor = $('#form-background-color').val() || '#ffffff';
        let textColor = $('#form-text-color').val() || '#333333';
        let fontFamily = $('#form-font-family').val() || 'Verdana, Geneva, sans-serif';
        let ariaLabel = $('#form-aria-label').val() || '';
        let ariaHidden = $('#form-aria-hidden').is(':checked');
        let formLayout = $('#form-layout').val() || 'one-column';
        globalFormSettings = { action, method, id, class: className, primaryColor, backgroundColor, textColor, fontFamily, ariaLabel, ariaHidden, formLayout };
        $(':root').css('--bs-primary', primaryColor);
        const modalEl = document.getElementById('formSettingsModal');
        const modal = bootstrap.Modal.getInstance(modalEl);
        modal.hide();
        $(this)[0].reset();
      });

      // Basic Form Validation on Generated Form Submission (Demo)
      $(document).on('submit', '#my-generated-form', function(e) {
        e.preventDefault();
        let isValid = true;
        $(this).find('[required]').each(function() {
          if (!$(this).val()) {
            isValid = false;
            $(this).addClass('is-invalid');
            if ($(this).next('.invalid-feedback').length === 0) {
              $(this).after('<div class="invalid-feedback">This field is required.</div>');
            }
            $(this).next('.invalid-feedback').show();
          } else {
            $(this).removeClass('is-invalid').addClass('is-valid');
            $(this).next('.invalid-feedback').hide();
          }
        });
        alert(isValid ? 'Form submitted successfully!' : 'Please fill out the required fields correctly.');
      });

      // Accessibility Enhancements: Trap focus in modals
      $('body').on('shown.bs.modal', '.modal', function () {
        const $this = $(this);
        const $focusableElements = $this.find('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]');
        const firstFocusable = $focusableElements.first();
        const lastFocusable = $focusableElements.last();
        firstFocusable.focus();
        $this.on('keydown', function(e) {
          if (e.key === 'Tab' || e.keyCode === 9) {
            if (e.shiftKey) { if (document.activeElement === firstFocusable[0]) { e.preventDefault(); lastFocusable.focus(); } }
            else { if (document.activeElement === lastFocusable[0]) { e.preventDefault(); firstFocusable.focus(); } }
          }
        });
      });
      $('body').on('hidden.bs.modal', '.modal', function () { $(this).off('keydown'); });

      // Update Range Display Value Dynamically
      $(document).on('input change', 'input[type="range"]', function() {
        let value = $(this).val();
        let displaySpanId = $(this).attr('id') + '_value';
        $('#' + displaySpanId).text(value);
        $(this).attr('aria-valuenow', value);
      });
    });
  </script>
</body>
</html>
